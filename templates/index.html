<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Prediction</title>
</head>
<body>
    <h1>Upload an Image for Prediction</h1>

    <form id="uploadForm" enctype="multipart/form-data" onsubmit="event.preventDefault(); uploadImage();">
        <label for="file">Choose an image:</label>
        <input type="file" id="file" name="file" accept="image/*" onchange="previewImage(event)">
        <br>
        <label for="model">Select Model:</label>
        <select id="model" name="model">
            <option value="yolo">YOLOv11</option>
            <option value="cnn">CNN</option>
            <option value="faster_rcnn">Faster R-CNN</option>
        </select>
        <br><br>
        <button type="submit">Submit</button>
    </form>

    <h2>Image Preview</h2>
    <img id="preview" src="#" alt="Image preview" style="max-width: 300px; display: none;">

    <h2>Prediction Result</h2>
    <div id="resultdiv"></div>
    <img id="result" src="#" alt="Annotated Image" style="max-width: 300px; display:none;">

    <script>
        // Function to preview the selected image
        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = function() {
                const preview = document.getElementById('preview');
                preview.src = reader.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        // Function to upload the image and display predictions
        function uploadImage() {
            const formData = new FormData(document.getElementById('uploadForm'));
            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('resultdiv');
                const preview = document.getElementById('preview');

                // Check if an image URL is provided (for YOLO and Faster R-CNN) or just a result (for CNN)
                if (data.result && data.result.class !== undefined && data.result.confidence !== undefined) {
                    // Display only class and confidence for CNN
                    // preview.style.display = 'none';  // Hide preview for CNN
                    console.log("In 1st")
                    resultDiv.innerHTML = `<p>Class: ${data.result.class}</p><p>Confidence: ${data.result.confidence.toFixed(2)}</p>`;
                }
                else if (data.image_url) {
                    // Display annotated image for YOLO and Faster R-CNN
                    console.log("In 2nd")
                    result.src = `${data.image_url}?t=${new Date().getTime()}`;  // Add timestamp to prevent caching
                    result.style.display = 'block';
                    // resultDiv.innerHTML = `<pre>${JSON.stringify(data.result, null, 2)}</pre>`;
                } else {
                    console.error("Unexpected response format:", data);
                    resultDiv.innerHTML = "<p style='color: red;'>Error: Unexpected response format.</p>";
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = "<p style='color: red;'>An error occurred while processing the image.</p>";
            });
        }
    </script>
    
</body>
</html>
